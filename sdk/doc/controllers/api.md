# API

```ts
const api = new Api(client);
```

## Class Name

`Api`

## Methods

* [Query by Date Range](../../doc/controllers/api.md#query-by-date-range)
* [Retrieve by Payment Id](../../doc/controllers/api.md#retrieve-by-payment-id)
* [Query Archived Payments](../../doc/controllers/api.md#query-archived-payments)


# Query by Date Range

Query payments within a specified date time range.

These payments can be filtered by currency, minAmount, maxAmount, last4Digits & receivedEvents.

The API returns data for payments processed after 25 June 2024. For payments processed before then use our [query for historical payments](/products/payment-queries/@v1/query-archive.md).

```ts
async queryByDateRange(
  accept: string,
  startDate: string,
  endDate: string,
  pageSize?: number,
  currency?: string,
  minAmount?: number,
  maxAmount?: number,
  last4Digits?: string,
  entityReferences?: string,
  receivedEvents?: string,
  transactionReference?: string,
  requestOptions?: RequestOptions
): Promise<ApiResponse<PqQuerybydaterange200Response>>
```

## Parameters

| Parameter | Type | Tags | Description |
|  --- | --- | --- | --- |
| `accept` | `string` | Header, Required | - |
| `startDate` | `string` | Query, Required | An ISO 8601 date-time supplied as a string. Filters for payments that occurred after the specified date-time. Must be supplied alongside endDate. |
| `endDate` | `string` | Query, Required | An ISO 8601 date-time supplied as a string. Filters for payments that occurred below the specified date-time. Must be supplied alongside startDate. |
| `pageSize` | [`number \| undefined`](../../doc/models/number.md) | Query, Optional | The maximum number of payments to be returned in the response (max 300). |
| `currency` | `string \| undefined` | Query, Optional | The three digit currency code. |
| `minAmount` | [`number \| undefined`](../../doc/models/number.md) | Query, Optional | This is a whole number including the currency exponent (e.g. GBP has an exponent of 2, so for £2.50 supply:`250`). |
| `maxAmount` | [`number \| undefined`](../../doc/models/number.md) | Query, Optional | This is a whole number including the currency exponent (e.g. GBP has an exponent of 2, so for £2.50 supply:`250`). |
| `last4Digits` | `string \| undefined` | Query, Optional | The last four digits of the card number. |
| `entityReferences` | `string \| undefined` | Query, Optional | Your entity reference(s). |
| `receivedEvents` | `string \| undefined` | Query, Optional | Name of the event. |
| `transactionReference` | `string \| undefined` | Query, Optional | A unique reference generated by you, used to identify a payment throughout its lifecycle. This shouldn't be used in conjunction with the above fields. Use it as a single parameter to query data. |
| `requestOptions` | `RequestOptions \| undefined` | Optional | Pass additional request options. |

## Response Type

This method returns an [`ApiResponse`](../../doc/api-response.md) instance. The `result` property of this instance returns the response data which is of type [`PqQuerybydaterange200Response`](../../doc/models/pq-querybydaterange-200-response.md).

## Example Usage

```ts
const accept = 'application/vnd.worldpay.payment-queries-v1.hal+json';

const startDate = '04/28/2024 21:30:20';

const endDate = '05/31/2024 21:30:20';

const pageSize = 10;

const currency = 'GBP';

const minAmount = 0;

const maxAmount = 1000;

const last4Digits = '1111';

const entityReferences = 'entityReference1,entityReference2';

const receivedEvents = 'authorizationRequested, authorizationSucceeded';

const transactionReference = 'Memory265-13/08/1876';

try {
  const { result, ...httpResponse } = await api.queryByDateRange(
    accept,
    startDate,
    endDate,
    pageSize,
    currency,
    minAmount,
    maxAmount,
    last4Digits,
    entityReferences,
    receivedEvents,
    transactionReference
  );
  // Get more response info...
  // const { statusCode, headers } = httpResponse;
} catch (error) {
  if (error instanceof ApiError) {
    const errors = error.result;
    // const { statusCode, headers } = error;
  }
}
```

## Errors

| HTTP Status Code | Error Description | Exception Class |
|  --- | --- | --- |
| 400 | Bad request | [`PqQuerybydaterange400ResponseError`](../../doc/models/pq-querybydaterange-400-response-error.md) |


# Retrieve by Payment Id

Retrieve a single payment by payment ID.

The API returns detailed data for payments processed after 25 June 2024. For payments processed before then use our [query for historical payments](/products/payment-queries/@v1/query-archive.md).

```ts
async retrieveByPaymentId(
  accept: string,
  paymentId: string,
  requestOptions?: RequestOptions
): Promise<ApiResponse<PqQuerybypaymentid200Response>>
```

## Parameters

| Parameter | Type | Tags | Description |
|  --- | --- | --- | --- |
| `accept` | `string` | Header, Required | - |
| `paymentId` | `string` | Template, Required | Unique identifier generated for each payment. Historic `paymentId` values in UUID format. |
| `requestOptions` | `RequestOptions \| undefined` | Optional | Pass additional request options. |

## Response Type

This method returns an [`ApiResponse`](../../doc/api-response.md) instance. The `result` property of this instance returns the response data which is of type [`PqQuerybypaymentid200Response`](../../doc/models/pq-querybypaymentid-200-response.md).

## Example Usage

```ts
const accept = 'application/vnd.worldpay.payment-queries-v1.hal+json';

const paymentId = 'payv0A4Hx2eY1-5P2_CpV7qy0';

try {
  const { result, ...httpResponse } = await api.retrieveByPaymentId(
    accept,
    paymentId
  );
  // Get more response info...
  // const { statusCode, headers } = httpResponse;
} catch (error) {
  if (error instanceof ApiError) {
    const errors = error.result;
    // const { statusCode, headers } = error;
  }
}
```

## Example Response *(as JSON)*

```json
{
  "timestamp": "2025-06-08T16:11:13.164Z",
  "transactionReference": "89197aeb-c94a-456e-8014-1272fbcb64eb",
  "narrative": {
    "line1": "trading name",
    "line2": "order number"
  },
  "transactionType": "oneTime",
  "authorizationType": "authorization",
  "entity": "default",
  "issuer": {
    "authorizationCode": "T31306"
  },
  "scheme": {
    "reference": "MCCOLXT1C0104  "
  },
  "paymentInstrument": {
    "type": "card/plain+masked",
    "card": {
      "number": {
        "last4Digits": "1111",
        "cardBin": "444433"
      },
      "brand": "visa",
      "expiryDate": {
        "month": 5,
        "year": 2030
      },
      "countryCode": "GB",
      "fundingType": "credit",
      "issuerName": "AN ISSUING BANK LTD",
      "paymentAccountReference": "Q1HJZ28RKA1EBL470G9XYG90R5D3E",
      "category": "consumer"
    }
  },
  "value": {
    "currency": "GBP",
    "amount": 1200
  },
  "events": [
    {
      "eventName": "authorizationRequested",
      "timestamp": "2025-06-08T16:11:13.164Z"
    },
    {
      "eventName": "authorizationSucceeded",
      "timestamp": "2025-06-08T16:11:14.229Z",
      "outcome": "authorized"
    }
  ],
  "_links": {
    "self": {
      "href": "/paymentQueries/payments/payv0A4Hx2eY1-5P2_CpV7qy0"
    },
    "cardPayments:cancel": {
      "href": "https://access.worldpay.com/payments/authorizations/cancellations/{linkData}"
    },
    "cardPayments:settle": {
      "href": "https://access.worldpay.com/payments/settlements/full/{linkData}"
    },
    "cardPayments:partialSettle": {
      "href": "https://access.worldpay.com/payments/settlements/partials/{linkData}"
    },
    "cardPayments:events": {
      "href": "https://access.worldpay.com/payments/events/{linkData}"
    },
    "cardPayments:partialCancel": {
      "href": "https://access.worldpay.com/payments/authorizations/cancellations/partials/{linkData}"
    },
    "cardPayments:reverse": {
      "href": "https://access.worldpay.com/payments/authorizations/reversals/{linkData}"
    }
  }
}
```

## Errors

| HTTP Status Code | Error Description | Exception Class |
|  --- | --- | --- |
| 404 | The payment was not found. | [`PqQuerybypaymentid404ResponseError`](../../doc/models/pq-querybypaymentid-404-response-error.md) |


# Query Archived Payments

Query payments processed before 25 June 2024.

Provide a `transactionReference` and `entityReference` for a payment to find the matching payment in the archive.

```ts
async queryArchivedPayments(
  accept: string,
  transactionReference: string,
  entityReference: string,
  requestOptions?: RequestOptions
): Promise<ApiResponse<PqQueryhistoricalpayments200Response>>
```

## Parameters

| Parameter | Type | Tags | Description |
|  --- | --- | --- | --- |
| `accept` | `string` | Header, Required | - |
| `transactionReference` | `string` | Query, Required | A unique reference generated by you, used to identify a payment throughout its lifecycle. |
| `entityReference` | `string` | Query, Required | A merchant entity. |
| `requestOptions` | `RequestOptions \| undefined` | Optional | Pass additional request options. |

## Response Type

This method returns an [`ApiResponse`](../../doc/api-response.md) instance. The `result` property of this instance returns the response data which is of type [`PqQueryhistoricalpayments200Response`](../../doc/models/pq-queryhistoricalpayments-200-response.md).

## Example Usage

```ts
const accept = 'application/vnd.worldpay.payment-queries-v1.hal+json';

const transactionReference = '89197aeb-c94a-456e-8014-1272fbcb64eb';

const entityReference = 'default';

try {
  const { result, ...httpResponse } = await api.queryArchivedPayments(
    accept,
    transactionReference,
    entityReference
  );
  // Get more response info...
  // const { statusCode, headers } = httpResponse;
} catch (error) {
  if (error instanceof ApiError) {
    const errors = error.result;
    // const { statusCode, headers } = error;
  }
}
```

## Errors

| HTTP Status Code | Error Description | Exception Class |
|  --- | --- | --- |
| 400 | Bad request | [`PqQueryhistoricalpayments400ResponseError`](../../doc/models/pq-queryhistoricalpayments-400-response-error.md) |

